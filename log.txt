student_04_38e997d2a6d0@cloudshell:~ (qwiklabs-gcp-00-be900804ba79)$ terraform import 'module.instances_module.google_compute_instance.gce_instances["tf-instance-1"]' qwiklabs-gcp-00-be900804ba79/us-east1-d/tf-instance-1
module.instances_module.google_compute_instance.gce_instances["tf-instance-1"]: Importing from ID "qwiklabs-gcp-00-be900804ba79/us-east1-d/tf-instance-1"...
module.instances_module.google_compute_instance.gce_instances["tf-instance-1"]: Import prepared!
  Prepared google_compute_instance for import
module.instances_module.google_compute_instance.gce_instances["tf-instance-1"]: Refreshing state... [id=projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/instances/tf-instance-1]

Import successful!

The resources that were imported are shown above. These resources are now in
your Terraform state and will henceforth be managed by Terraform.

student_04_38e997d2a6d0@cloudshell:~ (qwiklabs-gcp-00-be900804ba79)$ terraform show
# module.instances_module.google_compute_instance.gce_instances["tf-instance-1"]:
resource "google_compute_instance" "gce_instances" {
    can_ip_forward          = false
    cpu_platform            = "AMD Rome"
    deletion_protection     = false
    enable_display          = false
    guest_accelerator       = []
    id                      = "projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/instances/tf-instance-1"
    instance_id             = "8200377324693901409"
    label_fingerprint       = "42WmSpB8rSM="
    labels                  = {}
    machine_type            = "e2-micro"
    metadata                = {}
    metadata_fingerprint    = "-akSSZXwugM="
    metadata_startup_script = <<-EOT
        #!/bin/bash
    EOT
    name                    = "tf-instance-1"
    project                 = "qwiklabs-gcp-00-be900804ba79"
    self_link               = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/instances/tf-instance-1"
    tags                    = []
    tags_fingerprint        = "42WmSpB8rSM="
    zone                    = "us-east1-d"

    boot_disk {
        auto_delete = true
        device_name = "persistent-disk-0"
        mode        = "READ_WRITE"
        source      = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/disks/tf-instance-1"

        initialize_params {
            image  = "https://www.googleapis.com/compute/v1/projects/debian-cloud/global/images/debian-11-bullseye-v20250415"
            labels = {}
            size   = 10
            type   = "pd-standard"
        }
    }

    network_interface {
        name               = "nic0"
        network            = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/global/networks/default"
        network_ip         = "10.142.0.2"
        subnetwork         = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/regions/us-east1/subnetworks/default"
        subnetwork_project = "qwiklabs-gcp-00-be900804ba79"
    }

    scheduling {
        automatic_restart   = true
        on_host_maintenance = "MIGRATE"
        preemptible         = false
    }

    shielded_instance_config {
        enable_integrity_monitoring = true
        enable_secure_boot          = false
        enable_vtpm                 = true
    }

    timeouts {}
}
student_04_38e997d2a6d0@cloudshell:~ (qwiklabs-gcp-00-be900804ba79)$ cat modules/instances/instances.tf 
resource "google_compute_instance" "gce_instances" {
  for_each = toset(["tf-instance-1", "tf-instance-2"])
  # ✅
  name         = each.value
  # ✅
  machine_type = "n2-standard-2"
  zone         = "us-east1-d"

  tags = ["foo", "bar"]

  # ✅
  boot_disk {
    initialize_params {
      image = "debian-cloud/debian-11"
      labels = {
        my_label = "value"
      }
    }
  }

    # ✅
  network_interface {
    network = "default"

    access_config {
      // Ephemeral public IP
    }
  }

#   metadata = {
#     foo = "bar"
#   }
  # ✅
  metadata_startup_script = <<-EOT
          #!/bin/bash
      EOT

  # ✅
  allow_stopping_for_update = true
}
student_04_38e997d2a6d0@cloudshell:~ (qwiklabs-gcp-00-be900804ba79)$ terraform state list
module.instances_module.google_compute_instance.gce_instances["tf-instance-1"]
student_04_38e997d2a6d0@cloudshell:~ (qwiklabs-gcp-00-be900804ba79)$ terraform import 'module.instances_module.google_compute_instance.gce_instances["tf-instance-2"]' qwiklabs-gcp-00-be900804ba79/us-east1-d/tf-instance-2
module.instances_module.google_compute_instance.gce_instances["tf-instance-2"]: Importing from ID "qwiklabs-gcp-00-be900804ba79/us-east1-d/tf-instance-2"...
module.instances_module.google_compute_instance.gce_instances["tf-instance-2"]: Import prepared!
  Prepared google_compute_instance for import
module.instances_module.google_compute_instance.gce_instances["tf-instance-2"]: Refreshing state... [id=projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/instances/tf-instance-2]

Import successful!

The resources that were imported are shown above. These resources are now in
your Terraform state and will henceforth be managed by Terraform.

student_04_38e997d2a6d0@cloudshell:~ (qwiklabs-gcp-00-be900804ba79)$ terraform state list
module.instances_module.google_compute_instance.gce_instances["tf-instance-1"]
module.instances_module.google_compute_instance.gce_instances["tf-instance-2"]
student_04_38e997d2a6d0@cloudshell:~ (qwiklabs-gcp-00-be900804ba79)$ terraform show
# module.instances_module.google_compute_instance.gce_instances["tf-instance-1"]:
resource "google_compute_instance" "gce_instances" {
    can_ip_forward          = false
    cpu_platform            = "AMD Rome"
    deletion_protection     = false
    enable_display          = false
    guest_accelerator       = []
    id                      = "projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/instances/tf-instance-1"
    instance_id             = "8200377324693901409"
    label_fingerprint       = "42WmSpB8rSM="
    labels                  = {}
    machine_type            = "e2-micro"
    metadata                = {}
    metadata_fingerprint    = "-akSSZXwugM="
    metadata_startup_script = <<-EOT
        #!/bin/bash
    EOT
    name                    = "tf-instance-1"
    project                 = "qwiklabs-gcp-00-be900804ba79"
    self_link               = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/instances/tf-instance-1"
    tags                    = []
    tags_fingerprint        = "42WmSpB8rSM="
    zone                    = "us-east1-d"

    boot_disk {
        auto_delete = true
        device_name = "persistent-disk-0"
        mode        = "READ_WRITE"
        source      = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/disks/tf-instance-1"

        initialize_params {
            image  = "https://www.googleapis.com/compute/v1/projects/debian-cloud/global/images/debian-11-bullseye-v20250415"
            labels = {}
            size   = 10
            type   = "pd-standard"
        }
    }

    network_interface {
        name               = "nic0"
        network            = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/global/networks/default"
        network_ip         = "10.142.0.2"
        subnetwork         = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/regions/us-east1/subnetworks/default"
        subnetwork_project = "qwiklabs-gcp-00-be900804ba79"
    }

    scheduling {
        automatic_restart   = true
        on_host_maintenance = "MIGRATE"
        preemptible         = false
    }

    shielded_instance_config {
        enable_integrity_monitoring = true
        enable_secure_boot          = false
        enable_vtpm                 = true
    }

    timeouts {}
}

# module.instances_module.google_compute_instance.gce_instances["tf-instance-2"]:
resource "google_compute_instance" "gce_instances" {
    can_ip_forward          = false
    cpu_platform            = "Intel Broadwell"
    deletion_protection     = false
    enable_display          = false
    guest_accelerator       = []
    id                      = "projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/instances/tf-instance-2"
    instance_id             = "3890323706958598241"
    label_fingerprint       = "42WmSpB8rSM="
    labels                  = {}
    machine_type            = "e2-micro"
    metadata                = {}
    metadata_fingerprint    = "-akSSZXwugM="
    metadata_startup_script = <<-EOT
        #!/bin/bash
    EOT
    name                    = "tf-instance-2"
    project                 = "qwiklabs-gcp-00-be900804ba79"
    self_link               = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/instances/tf-instance-2"
    tags                    = []
    tags_fingerprint        = "42WmSpB8rSM="
    zone                    = "us-east1-d"

    boot_disk {
        auto_delete = true
        device_name = "persistent-disk-0"
        mode        = "READ_WRITE"
        source      = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/disks/tf-instance-2"

        initialize_params {
            image  = "https://www.googleapis.com/compute/v1/projects/debian-cloud/global/images/debian-11-bullseye-v20250415"
            labels = {}
            size   = 10
            type   = "pd-standard"
        }
    }

    network_interface {
        name               = "nic0"
        network            = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/global/networks/default"
        network_ip         = "10.142.0.3"
        subnetwork         = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/regions/us-east1/subnetworks/default"
        subnetwork_project = "qwiklabs-gcp-00-be900804ba79"
    }

    scheduling {
        automatic_restart   = true
        on_host_maintenance = "MIGRATE"
        preemptible         = false
    }

    shielded_instance_config {
        enable_integrity_monitoring = true
        enable_secure_boot          = false
        enable_vtpm                 = true
    }

    timeouts {}
}


student_04_38e997d2a6d0@cloudshell:~ (qwiklabs-gcp-00-be900804ba79)$ terraform plan
module.instances_module.google_compute_instance.gce_instances["tf-instance-2"]: Refreshing state... [id=projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/instances/tf-instance-2]
module.instances_module.google_compute_instance.gce_instances["tf-instance-1"]: Refreshing state... [id=projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/instances/tf-instance-1]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
-/+ destroy and then create replacement

Terraform will perform the following actions:

  # module.instances_module.google_compute_instance.gce_instances["tf-instance-1"] must be replaced
-/+ resource "google_compute_instance" "gce_instances" {
      + allow_stopping_for_update = true
      ~ cpu_platform              = "AMD Rome" -> (known after apply)
      - enable_display            = false -> null
      ~ guest_accelerator         = [] -> (known after apply)
      ~ id                        = "projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/instances/tf-instance-1" -> (known after apply)
      ~ instance_id               = "8200377324693901409" -> (known after apply)
      ~ label_fingerprint         = "42WmSpB8rSM=" -> (known after apply)
      - labels                    = {} -> null
      ~ machine_type              = "e2-micro" -> "n2-standard-2"
      - metadata                  = {} -> null
      ~ metadata_fingerprint      = "-akSSZXwugM=" -> (known after apply)
      + min_cpu_platform          = (known after apply)
        name                      = "tf-instance-1"
      ~ project                   = "qwiklabs-gcp-00-be900804ba79" -> (known after apply)
      ~ self_link                 = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/instances/tf-instance-1" -> (known after apply)
      ~ tags                      = [
          + "bar",
          + "foo",
        ]
      ~ tags_fingerprint          = "42WmSpB8rSM=" -> (known after apply)
        # (4 unchanged attributes hidden)

      ~ boot_disk {
          ~ device_name                = "persistent-disk-0" -> (known after apply)
          + disk_encryption_key_sha256 = (known after apply)
          + kms_key_self_link          = (known after apply)
          ~ source                     = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/disks/tf-instance-1" -> (known after apply)
            # (2 unchanged attributes hidden)

          ~ initialize_params {
              ~ image  = "https://www.googleapis.com/compute/v1/projects/debian-cloud/global/images/debian-11-bullseye-v20250415" -> "debian-cloud/debian-11"
              ~ labels = { # forces replacement
                  + "my_label" = "value"
                }
              ~ size   = 10 -> (known after apply)
              ~ type   = "pd-standard" -> (known after apply)
            }
        }

      ~ network_interface {
          ~ name               = "nic0" -> (known after apply)
          ~ network            = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/global/networks/default" -> "default"
          ~ network_ip         = "10.142.0.2" -> (known after apply)
          ~ subnetwork         = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/regions/us-east1/subnetworks/default" -> (known after apply)
          ~ subnetwork_project = "qwiklabs-gcp-00-be900804ba79" -> (known after apply)

          + access_config {
              + nat_ip       = (known after apply)
              + network_tier = (known after apply)
            }
        }

      - scheduling {
          - automatic_restart   = true -> null
          - on_host_maintenance = "MIGRATE" -> null
          - preemptible         = false -> null
        }

      - shielded_instance_config {
          - enable_integrity_monitoring = true -> null
          - enable_secure_boot          = false -> null
          - enable_vtpm                 = true -> null
        }

      - timeouts {}
    }

  # module.instances_module.google_compute_instance.gce_instances["tf-instance-2"] must be replaced
-/+ resource "google_compute_instance" "gce_instances" {
      + allow_stopping_for_update = true
      ~ cpu_platform              = "Intel Broadwell" -> (known after apply)
      - enable_display            = false -> null
      ~ guest_accelerator         = [] -> (known after apply)
      ~ id                        = "projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/instances/tf-instance-2" -> (known after apply)
      ~ instance_id               = "3890323706958598241" -> (known after apply)
      ~ label_fingerprint         = "42WmSpB8rSM=" -> (known after apply)
      - labels                    = {} -> null
      ~ machine_type              = "e2-micro" -> "n2-standard-2"
      - metadata                  = {} -> null
      ~ metadata_fingerprint      = "-akSSZXwugM=" -> (known after apply)
      + min_cpu_platform          = (known after apply)
        name                      = "tf-instance-2"
      ~ project                   = "qwiklabs-gcp-00-be900804ba79" -> (known after apply)
      ~ self_link                 = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/instances/tf-instance-2" -> (known after apply)
      ~ tags                      = [
          + "bar",
          + "foo",
        ]
      ~ tags_fingerprint          = "42WmSpB8rSM=" -> (known after apply)
        # (4 unchanged attributes hidden)

      ~ boot_disk {
          ~ device_name                = "persistent-disk-0" -> (known after apply)
          + disk_encryption_key_sha256 = (known after apply)
          + kms_key_self_link          = (known after apply)
          ~ source                     = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/zones/us-east1-d/disks/tf-instance-2" -> (known after apply)
            # (2 unchanged attributes hidden)

          ~ initialize_params {
              ~ image  = "https://www.googleapis.com/compute/v1/projects/debian-cloud/global/images/debian-11-bullseye-v20250415" -> "debian-cloud/debian-11"
              ~ labels = { # forces replacement
                  + "my_label" = "value"
                }
              ~ size   = 10 -> (known after apply)
              ~ type   = "pd-standard" -> (known after apply)
            }
        }

      ~ network_interface {
          ~ name               = "nic0" -> (known after apply)
          ~ network            = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/global/networks/default" -> "default"
          ~ network_ip         = "10.142.0.3" -> (known after apply)
          ~ subnetwork         = "https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-be900804ba79/regions/us-east1/subnetworks/default" -> (known after apply)
          ~ subnetwork_project = "qwiklabs-gcp-00-be900804ba79" -> (known after apply)

          + access_config {
              + nat_ip       = (known after apply)
              + network_tier = (known after apply)
            }
        }

      - scheduling {
          - automatic_restart   = true -> null
          - on_host_maintenance = "MIGRATE" -> null
          - preemptible         = false -> null
        }

      - shielded_instance_config {
          - enable_integrity_monitoring = true -> null
          - enable_secure_boot          = false -> null
          - enable_vtpm                 = true -> null
        }

      - timeouts {}
    }

Plan: 2 to add, 0 to change, 2 to destroy.